['¾ cup assorted dals (such as chana dal, moong dal, masoor dal, and/or urad dal)', '¼ cup white jasmine rice or other long-grain rice', '¼ cup pearl barley', '1½ lb. bone-in lamb stew meat', '3 tsp. kosher salt, divided, plus more', '1 6" piece fresh ginger', '3 medium shallots, thinly sliced', '⅓ cup ghee or vegetable oil', '4 garlic cloves, finely grated', '2 Tbsp. plus 1½ tsp. garam masala', '1 tsp. (or more) cayenne pepper', '1 tsp. ground turmeric', '3 green Thai chiles, stems removed (optional)', '½ cup (lightly packed) chopped cilantro, plus more for serving', '½ white onion, finely chopped', '2 limes', 'cut into wedges']

Combine dals, rice, and barley in a medium bowl. Pour in water to cover and swish dals and grains around with your fingers. Drain and repeat process until water runs clear enough to see your hands through. Pour in water to cover and let dals and grains soak at room temperature at least 2 hours, or cover and chill up to 12 hours.
Place lamb on a plate, pat dry with paper towels, and season all over with 2 tsp. salt; set aside. Peel ginger by scraping off skin with a spoon. Finely grate half of ginger; set aside. Thinly slice remaining ginger. Stack slices and cut crosswise into matchsticks; set aside.
If using an electric pressure cooker, combine shallots and ghee in pot and set to sauté function or high. Cook, stirring often and adjusting heat as needed if your cooker has that option, until shallots are just beginning to brown, about 8 minutes (or about 6 minutes if cooking in oil). Reduce to normal function or medium if possible, or, if your cooker doesn’t have a lower setting, turn off for a minute if mixture is getting too hot. Add reserved ginger matchsticks and cook, stirring often, until shallots are brown and crisp and ginger is frizzled, 4–10 minutes, depending on your cooker. Using a slotted spoon, transfer shallots and ginger to a plate, spreading out into a single layer. Season lightly with salt; let cool.
Add garlic, garam masala, cayenne, turmeric, and reserved grated ginger, and cook, stirring constantly, until fragrant, about 30 seconds. Add lamb and stir to coat in spices. Cook, stirring often with a wooden spoon and repeatedly adding splashes of water as spices begin to stick to bottom of pot and scraping up browned bits, until flavors come together, about 15 minutes.(Bhuna, the process of repeated sticking and scraping, is a Southeast Asian cooking technique that brings out the flavor of the spices and ensures they don’t taste raw and grainy.)
Drain dal mixture and add to pot along with 1 tsp. salt and 5 cups water. Secure lid and bring to full pressure according to manufacturer’s directions. Cook 1½ hours. Let sit 20 minutes, then manually release pressure and open up.
Taste haleem and add more salt and cayenne if needed. Add chiles if using. (These are for flavor, not heat; feel free to leave them out.) Simmer on normal function or medium, stirring often, 5 minutes. Stir in ½ cup cilantro.
Serve haleem with white onion, lime wedges, reserved crispy shallots and ginger, and more chopped cilantro.
If using a medium Dutch oven or stovetop pressure cooker, cook shallots and ghee over high heat, stirring often, until shallots are just beginning to brown, about 8 minutes (or about 6 minutes if cooking in oil). Add reserved ginger matchsticks and cook, stirring often, until shallots are brown and crisp and ginger is frizzled, 5–8 minutes. Using a slotted spoon, transfer shallots and ginger to a plate, spreading out in a single layer. Season lightly with salt; let cool.
Reduce heat to medium, add garlic, garam masala, cayenne, turmeric, and reserved grated ginger, and cook, stirring constantly, until fragrant, about 30 seconds. Add lamb and stir to coat in spices. Cook, stirring often with a wooden spoon and repeatedly adding splashes of water as spices begin to stick to bottom of pot and scraping up browned bits, until flavors come together, about 15 minutes. (Bhuna, the process of repeated sticking and scraping, is a Southeast Asian cooking technique that brings out the flavor of the spices and ensures they don’t taste raw and grainy.)
Drain dal mixture and add to pot along with 1 tsp. salt and 6½ cups water (if using a Dutch oven) or 5 cups water (for pressure cooker). Increase heat to high and bring to a boil, then reduce heat to the low, cover pot, and cook, stirring and scraping bottom of pot every 15–20 minutes, until meat is falling off the bone and dals and grains have nearly melted into the stew, 4½–5 hours. (If using a stovetop cooker, increase heat to high and bring to a boil. Secure lid and bring to full pressure according to manufacturer’s directions. Cook 1½ hours. Let sit 20 minutes, then manually release pressure and open up.)
Taste haleem and add more salt and cayenne if needed. Add chiles if using. (These are for flavor, not heat; feel free to leave them out.) Simmer over medium heat, stirring often, 5 minutes. Stir in ½ cup cilantro.
Serve haleem with white onion, lime wedges, reserved crispy shallots and ginger, and more chopped cilantro.
Do ahead: Haleem can be made 1 day ahead. Let cool; cover and chill. Reheat over medium until warmed through.